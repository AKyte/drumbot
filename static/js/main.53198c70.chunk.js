(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{182:function(t,e,n){},183:function(t,e,n){},184:function(t,e,n){},185:function(t,e,n){"use strict";n.r(e);n(85);var a=n(1),r=n.n(a),o=n(80),i=n.n(o),s=(n(182),n(183),n(19)),c=n(20),u=n(82),l=n(81),m=n(83),p=(n(184),n(35)),h=function(){function t(e){Object(s.a)(this,t),this.buffer=e}return Object(c.a)(t,[{key:"play",value:function(t){var e=t.context,n=t.timing,a=t.destination,r=e.createBufferSource();r.buffer=this.buffer,r.connect(a),r.start(n)}}]),t}(),d=["clap","cowbell","kick","snare","hihat","ride","rim"],f=function(){function t(){var e=this;Object(s.a)(this,t),this.prepare=function(t){return Promise.all(d.map(function(n){return e.loadSample(t,n)}))},this.loadSample=function(t,n){var a="./samples/".concat(n,".wav");return new Promise(function(r,o){var i=new XMLHttpRequest;i.open("GET",a,!0),i.responseType="arraybuffer",i.onload=function(){var a=i.response;t.decodeAudioData(a,function(t){e.instruments[n]=new h(t),r()},o)},i.send()})},this.instruments={}}return Object(c.a)(t,[{key:"play",value:function(t){var e=t.context,n=t.instrument,a=t.timing,r=this.instruments[n],o=e.createGain();o.gain.setValueAtTime(.1,a),o.connect(e.destination),r&&r.play({context:e,timing:a,destination:o})}}]),t}(),v={absolute:-1,measure:-1,step:-1,time:-1},g=window.AudioContext||window.webkitAudioContext;function b(){return new g}var S=function(){function t(e){var n=this,a=e.onStep;Object(s.a)(this,t),this.prepare=function(){return n.soundPlayer.prepare(n.context)},this.startClock=function(t){n.stepsPerSecond=t/60*4,n.context=b(),n.playing=!0,n.scheduleSounds(n.getPosition(0)),n.context.resume(),n.onTick()},this.stopClock=function(){n.playing=!1,n.position=v,n.context.suspend(),n.context.close()},this.onTick=function(){var t=n.getStepAbsolute(n.context.currentTime);t!==n.position.absolute&&n.setCurrentStepAbsolute(t),n.playing?requestAnimationFrame(n.onTick):(n.position=v,n.onStep({position:n.position}))},this.scheduleSounds=function(t){n.playing&&n.pattern.tracks.forEach(function(e){e.steps[t.step]&&n.soundPlayer.play({context:n.context,instrument:e.instrument,timing:t.timing})})},this.onStep=a,this.position=v,this.context=function(){var t=b();if(/(iPhone|iPad)/i.test(navigator.userAgent)&&44100!==t.sampleRate){var e=t.createBuffer(1,1,44100),n=t.createBufferSource();return n.buffer=e,n.connect(t.destination),n.start(0),n.disconnect(),t.close(),b()}return t}(),this.soundPlayer=new f}return Object(c.a)(t,[{key:"setPattern",value:function(t){this.pattern=t}},{key:"getStepAbsolute",value:function(t){return Math.floor((t-.25)*this.stepsPerSecond)}},{key:"setCurrentStepAbsolute",value:function(t){this.onStep({position:this.getPosition(t)}),this.scheduleSounds(this.getPosition(t+1))}},{key:"getPosition",value:function(t){var e=this.pattern.stepCount;return{measure:Math.floor(t/e),step:t%e,timing:t/this.stepsPerSecond+.25,absolute:t}}}]),t}(),_=Object({NODE_ENV:"production",PUBLIC_URL:"/drumbot"}).REACT_APP_API_HOST||"https://api.noopschallenge.com",E=function(t){function e(){var t,n;Object(s.a)(this,e);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(u.a)(this,(t=Object(l.a)(e)).call.apply(t,[this].concat(r)))).state={poweredOn:!1,loading:!0,playing:!1,startTime:0,position:{},pattern:{tracks:[]}},n.powerOn=function(){n.audioEngine=new S({onStep:n.onStep}),n.audioEngine.prepare().then(function(){return Object(p.fetch)("".concat(_,"/drumbot/patterns")).then(function(t){return t.json()}).then(function(t){n.setState({patterns:t,poweredOn:!0},function(){var e=Math.floor(Math.random()*t.length);n.selectPattern(e)})},function(t){n.setState({error:"Oops. Something went wrong. Please check your connection and refresh your browser.",loading:!1})})},function(t){n.setState({error:!0,loading:!1})})},n.startClock=function(){n.audioEngine.startClock(n.state.pattern.beatsPerMinute),n.setState({playing:!0})},n.stopClock=function(){n.audioEngine.stopClock(),n.setState({playing:!1})},n.onStep=function(t){var e=t.position;n.setState({position:e})},n.nextPattern=function(){n.selectPattern(n.state.patternIndex+1)},n.previousPattern=function(){n.selectPattern(n.state.patternIndex-1)},n}return Object(m.a)(e,t),Object(c.a)(e,[{key:"componentDidMount",value:function(){if(!g)return this.setState({loading:!1,error:"This browser does not support WebAudio. Try Edge, Firefox, Chrome or Safari."})}},{key:"selectPattern",value:function(t){var e=this;t<0&&(t=this.state.patterns.length-1),t>=this.state.patterns.length&&(t=0);var n=this.state.patterns[t];this.state.playing&&this.stopClock(),Object(p.fetch)("".concat(_,"/drumbot/patterns/").concat(n.name)).then(function(t){return t.json()}).then(function(n){e.setState({pattern:n,patternIndex:t,loading:!1}),e.audioEngine.setPattern(n)})}},{key:"render",value:function(){if(this.state.error)return r.a.createElement("div",{className:"DrumMachine__Error"},this.state.error);if(!this.state.poweredOn)return r.a.createElement("div",{className:"DrumMachine"},r.a.createElement("div",{className:"DrumMachine__GetStarted"},r.a.createElement("p",null,"Welcome to drumbot"),r.a.createElement("button",{className:"DrumMachine__StartStopButton",onClick:this.powerOn},"Start!")));var t=this.state,e=t.pattern,n=e.tracks,a=e.name,o=t.position.step;return r.a.createElement("div",{className:"DrumMachine"},r.a.createElement("div",{className:"DrumMachine__TopPanel"},r.a.createElement("div",{className:"DrumMachine__Logo"},r.a.createElement("div",{className:"DrumMachine__Title"},"PR-606"),r.a.createElement("div",{className:"DrumMachine__SubTitle"},"FORKABLE DRUM COMPUTER")),this.state.poweredOn&&r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"DrumMachine__PatternSelector"},r.a.createElement("div",{className:"DrumMachine__PatternButton"},r.a.createElement("button",{onClick:this.previousPattern},"<")),r.a.createElement("div",{className:"DrumMachine__SelectedPattern"},a),r.a.createElement("div",{className:"DrumMachine__PatternButton"},r.a.createElement("button",{onClick:this.nextPattern},">"))),r.a.createElement("div",{className:"DrumMachine__Transport"},r.a.createElement("button",{disabled:this.state.playing,className:"DrumMachine__StartStopButton",onClick:this.startClock},"Start"),r.a.createElement("button",{disabled:!this.state.playing,className:"DrumMachine__StartStopButton",onClick:this.stopClock},"Stop")))),r.a.createElement("div",{className:"DrumMachine__Tracks"},n.map(function(t,e){return r.a.createElement("div",{className:"DrumMachine__Track",key:e},r.a.createElement("div",{className:"DrumMachine__TrackLabel"},t.instrument),r.a.createElement("div",{className:"DrumMachine__TrackSteps"},t.steps.map(function(t,e){return r.a.createElement("div",{className:"DrumMachine__Step DrumMachine__Step--".concat(o===e?"Active":"Inactive"," DrumMachine__Step--").concat(t?"On":"Off"),key:e})})))})),r.a.createElement("div",{className:"DrumMachine__Footer"},r.a.createElement("div",null,"Join the fun at ",r.a.createElement("a",{href:"https://noopschallenge.com"},"noopschallenge.com")),r.a.createElement("div",null,r.a.createElement("a",{href:"https://github.com/noops-challenge/drumbot"},"Fork me on GitHub"))))}}]),e}(r.a.Component);var k=function(){return r.a.createElement("div",{className:"App"},r.a.createElement(E,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(k,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(t){t.unregister()})},84:function(t,e,n){t.exports=n(185)}},[[84,1,2]]]);
//# sourceMappingURL=main.53198c70.chunk.js.map